<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:include src="common/navigationBar.xhtml"></ui:include>

	<p:panel style="width: 60%"
		rendered="#{worklistHandlerAction.selectedPatient ne null}"
		styleClass="collapsedBorders noPadding noBorders">

		<h:panelGrid columns="3"
			styleClass="defaultListingTableTwoLineContainer">
			<!-- left column -->
			<h:panelGrid columns="2" styleClass="defaultListingTableCss">

				<!-- piz -->
				<h:outputLabel value="#{msg['body.worklist.patient.piz']}" />
				<h:outputLabel value="#{worklistHandlerAction.selectedPatient.piz}" />

				<!-- name -->
				<h:outputLabel value="#{msg['body.worklist.patient.name']}" />
				<h:outputLabel
					value="#{worklistHandlerAction.selectedPatient.person.name}#{worklistHandlerAction.selectedPatient.person.title ne '' ? ',' : ''} #{worklistHandlerAction.selectedPatient.person.title}" />

				<!-- street -->
				<p:outputLabel value="#{msg['body.worklist.patient.street']}" />
				<p:outputLabel
					value="#{worklistHandlerAction.selectedPatient.person.street}" />

				<!-- postcode -->
				<p:outputLabel value="#{msg['body.worklist.patient.postcode']}" />
				<p:outputLabel
					value="#{worklistHandlerAction.selectedPatient.person.postcode}" />

				<!-- phone -->

				<p:outputLabel value="#{msg['body.worklist.patient.phone']}" />
				<p:outputLabel
					value="#{worklistHandlerAction.selectedPatient.person.phoneNumber}" />

				<!-- extern -->
				<p:outputLabel value="#{msg['body.worklist.patient.extern']}" />

				<h:panelGroup>
					<p:outputLabel
						value="#{worklistHandlerAction.selectedPatient.externalPatient ? msg['general.yes'] : msg['general.no']} &nbsp; " />
					<p:commandLink
						rendered="#{worklistHandlerAction.selectedPatient.externalPatient}"
						actionListener="#{patientHandlerAction.prepareEditExternalPatientDialog(worklistHandlerAction.selectedPatient)}">
						<p:ajax event="dialogReturn" update="navigationForm contentForm" />
						<i class="fa fa-wrench"></i>
					</p:commandLink>
				</h:panelGroup>
			</h:panelGrid>

			<h:panelGroup />

			<!-- right column -->
			<h:panelGrid columns="2" styleClass="defaultListingTableCss">

				<h:outputLabel value="" />
				<h:outputLabel value="" />

				<!-- surname -->
				<h:outputLabel value="#{msg['body.worklist.patient.surname']}" />
				<h:outputLabel
					value="#{worklistHandlerAction.selectedPatient.person.surname}" />

				<!-- birthday -->
				<p:outputLabel value="#{msg['body.worklist.patient.birthday']}" />
				<p:outputLabel
					value="#{ worklistHandlerAction.selectedPatient.person.birthday ne null ? mainHandlerAction.date(worklistHandlerAction.selectedPatient.person.birthday) : ''}" />

				<!-- town -->
				<p:outputLabel value="#{msg['body.worklist.patient.town']}" />
				<p:outputLabel
					value=" #{worklistHandlerAction.selectedPatient.person.town}" />

				<!-- insurance -->

				<p:outputLabel value="#{msg['body.worklist.patient.insurance']}" />
				<p:outputLabel
					value="#{worklistHandlerAction.selectedPatient.insurance}" />
			</h:panelGrid>
		</h:panelGrid>

		<p:dataTable var="task" style="margin-top:20px;" id="taskList"
			value="#{worklistHandlerAction.selectedPatient.tasks}"
			selectionMode="single"
			styleClass="defaultDataTable noBordersAll collapsedBordersAll"
			rendered="#{worklistHandlerAction.selectedPatient != null}"
			selection="#{worklistHandlerAction.selectedPatient.selectedTask}"
			rowKey="#{task.id}">

			<p:ajax event="rowSelect" update=":contentForm, :headerForm"
				listener="#{worklistHandlerAction.onSelectTaskAndPatient(worklistHandlerAction.selectedPatient.selectedTask)}" />

			<p:column>
				<f:facet name="header">
					<h:panelGrid columns="2" styleClass="defaultListingTableContainer">
						<h:outputLabel value="#{msg['body.worklist.patient.tasks']}"
							style="float:left;"></h:outputLabel>
						<p:commandLink id="taskList"
							actionListener="#{createTaskDialogHandler.initAndPrepareBean(worklistHandlerAction.selectedPatient)}">
							<p:ajax event="dialogReturn" update="navigationForm contentForm" />
							<i class="fa fa-plus" style="float: right"></i>
						</p:commandLink>
					</h:panelGrid>
				</f:facet>

				<h:outputText
					value="#{task.taskID} - #{mainHandlerAction.date(task.dateOfReceiptAsDate)}" />

				<h:panelGroup rendered="#{task.isNew()}">
					<h:outputText value=" ("></h:outputText>
					<h:outputText value="Neu" style="color:green;" />
					<h:outputText value=") "></h:outputText>
				</h:panelGroup>

				<!-- staining needed -->
				<h:panelGroup rendered="#{task.status.stainingPhase}">
					<!-- staining needed = green -->
					<ui:fragment rendered="#{task.status.stainingNeeded}">
						<ui:fragment rendered="#{task.status.diagnosisNeeded}">
							<h:outputText value=" ("></h:outputText>
							<h:outputText
								value="#{msg['body.worklist.patient.stainingPhase.stainingNeeded']}"
								style="color:green;" />
							<h:outputText value=") "></h:outputText>
						</ui:fragment>
					</ui:fragment>

					<!-- re-staining needed = orange -->
					<ui:fragment rendered="#{task.status.reStainingNeeded}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.stainingPhase.reStainingNeeded']}"
							style="color:orange;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>

					<!--  no staining needed = purple -->
					<ui:fragment rendered="#{task.status.stayInStainingPhase}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.stainingPhase.inList']}"
							style="color:purple;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>
				</h:panelGroup>

				<!-- diagnosis needed -->
				<h:panelGroup rendered="#{task.status.diagnosisPhase}">
					<!-- diagnosis needed = green -->
					<ui:fragment rendered="#{task.status.diagnosisNeeded}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.diagnosisPhase.diagnosisNeeded']}"
							style="color:green;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>

					<!-- re-diagnosis needed = orange -->
					<ui:fragment rendered="#{task.status.reDiagnosisNeeded}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.diagnosisPhase.reDiagnosisNeeded']}"
							style="color:orange;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>

					<!-- no diagnosis needed = purple -->
					<ui:fragment rendered="#{task.status.diagnosisStayInPhase}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.diagnosisPhase.inList']}"
							style="color:purple;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>
				</h:panelGroup>

				<!-- notification needed -->
				<h:panelGroup rendered="#{task.status.notificationPhase}">
					<!-- notification need = green -->
					<ui:fragment rendered="#{task.status.notificationNeeded}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.notificationPhase.notificationNeeded']}"
							style="color:green;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>

					<!-- stay in phase = purple -->
					<ui:fragment rendered="#{task.status.notificationStayInPhase}">
						<h:outputText value=" ("></h:outputText>
						<h:outputText
							value="#{msg['body.worklist.patient.notificationPhase.inList']}"
							style="color:purple;" />
						<h:outputText value=") "></h:outputText>
					</ui:fragment>
				</h:panelGroup>

			</p:column>

		</p:dataTable>


		<p:dataTable var="attachedPdf" style="margin-top:50px;"
			id="attachedPdfList"
			value="#{worklistHandlerAction.selectedPatient.attachedPdfs}"
			styleClass="defaultDataTable noBordersAll collapsedBordersAll"
			rendered="#{worklistHandlerAction.selectedPatient != null}">


			<p:column style="width:30%">
				<f:facet name="header">
					<h:outputLabel value="#{msg['body.worklist.patient.pdfs.name']}"></h:outputLabel>
				</f:facet>

				<h:outputLabel value="#{attachedPdf.name}"></h:outputLabel>
			</p:column>

			<p:column style="width:18%">
				<f:facet name="header">
					<h:outputLabel value="#{msg['body.worklist.patient.pdfs.date']}"></h:outputLabel>
				</f:facet>
				<h:outputLabel
					value="#{mainHandlerAction.date(attachedPdf.creationDateAsDate,enumProvider.getDateFormat('GERMAN_TIME_DATE'))}"></h:outputLabel>
			</p:column>
			<p:column style="width:10%">
				<f:facet name="header">
					<h:outputLabel value="#{msg['body.worklist.patient.pdfs.type']}"></h:outputLabel>
				</f:facet>
				<h:outputLabel
					value="#{msg['enum.documentType.'.concat(attachedPdf.type)]}"></h:outputLabel>
			</p:column>
			<p:column style="auto">
				<f:facet name="header">
					<h:outputLabel
						value="#{msg['body.worklist.patient.pdfs.commentary']}"></h:outputLabel>
				</f:facet>
				<h:outputLabel value="#{attachedPdf.commentary}"></h:outputLabel>
			</p:column>
			<p:column style="width:15px">
				<f:facet name="header">
					<h:panelGrid columns="1" styleClass="defaultListingTableContainer">
						<p:commandLink id="upload"
							actionListener="#{mediaHandlerAction.prepareMediaDisplayDialog(worklistHandlerAction.selectedPatient)}">
							<p:ajax event="dialogReturn" update="navigationForm contentForm" />
							<i class="fa fa-plus"></i>
						</p:commandLink>
					</h:panelGrid>
				</f:facet>
				<p:commandLink
					actionListener="#{mediaHandlerAction.prepareMediaDisplayDialog(worklistHandlerAction.selectedPatient,attachedPdf)}">
					<p:ajax event="dialogReturn" update="navigationForm contentForm" />
					<i class="fa fa-search"></i>
				</p:commandLink>
			</p:column>

		</p:dataTable>
	</p:panel>
</ui:composition>
