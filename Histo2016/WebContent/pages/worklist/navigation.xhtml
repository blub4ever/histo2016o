<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<!-- Search -->
	<h:panelGroup styleClass="searchContainer" layout="block">
		<p:focus context="form" for="searchField" />
		<p:inputText placeholder="#{msg.headSearch}" id="searchField"
			styleClass="seachFiled" value="#{worklistHandlerAction.searchString}">
			<p:ajax event="keyup"
				listener="#{worklistHandlerAction.searchForExistingPatients()}" />
		</p:inputText>
	</h:panelGroup>

	<!-- Nav Table -->
	<p:dataTable var="patient" id="patientList"
		value="#{worklistHandlerAction.restrictedWorkList}"
		selectionMode="single"
		selection="#{worklistHandlerAction.selectedPatient}"
		rowKey="#{patient.id}" styleClass="navTable">
		<p:ajax event="rowSelect" update=":contentForm, :headerForm"
			listener="#{worklistHandlerAction.selectPatient(worklistHandlerAction.selectedPatient)}" />
		<p:column>
			<!-- Header -->
			<f:facet name="header">
				<h:panelGroup layout="block">
					<h:outputLabel value="#{msg['body.worklist.navigation.headline']}"
						style="float:left;"></h:outputLabel>
					<h:panelGroup style="float: right">
						<p:commandLink title="#{msg['body.worklist.navigation.up']}"
							actionListener="#{worklistHandlerAction.selectPreviouseTask()}"
							update="navigationForm contentForm">
							<i class="fa fa-arrow-circle-up"></i>
						</p:commandLink>
						<p:commandLink title="#{msg['body.worklist.navigation.down']}"
							actionListener="#{worklistHandlerAction.selectNextTask()}"
							update="navigationForm contentForm">
							<i class="fa fa-arrow-circle-down"></i>
						</p:commandLink>

						<p:commandLink title="#{msg['body.worklist.navigation.sort']}"
							id="listOrder"
							actionListener="#{worklistHandlerAction.prepareWorklistOptions()}">
							<i class="fa fa-th-list"></i>
						</p:commandLink>

						<p:commandLink
							title="#{msg['body.worklist.navigation.changlist']}"
							actionListener="#{worklistHandlerAction.prepareWorklistOptions()}">
							<i class="fa fa-cog"></i>
							<p:ajax event="dialogReturn" update="navigationForm contentForm" />
						</p:commandLink>
					</h:panelGroup>
				</h:panelGroup>
			</f:facet>

			<!-- Data -->
			<p:panelGrid styleClass="contentTable noBordersAll">

				<p:row>
					<p:column>
						<h:outputText
							value="#{patient.person.name}, #{patient.person.surname}" />

					</p:column>
					<p:column>
						<h:outputText
							value="PIZ: #{patient.piz ne 0 ? patient.piz : 'none'}" />
					</p:column>
				</p:row>
				<p:row>
					<p:column>
						<h:outputLabel
							value="#{helperHandlerAction.simpleDateFormatter(patient.person.birthday)}"
							rendered="#{patient.person.birthday ne null}" />
					</p:column>
					<p:column>
					</p:column>
				</p:row>
				<!-- Tasks -->
				<p:row>
					<p:column style="vertical-align: top !important;">
						<h:outputLabel
							value="#{msg['body.worklist.navigation.activtasks']}" />
					</p:column>
					<p:column>
						<!-- no tasks -->
						<h:outputLabel rendered="#{patient.activTasks.size() eq 0}"
							value="#{msg['body.worklist.navigation.activtasks.none']}"></h:outputLabel>

						<!-- task list -->
						<p:repeat var="task" value="#{patient.activTasks}">
							<p:commandLink
								actionListener="#{worklistHandlerAction.selectTaskOfPatient(task)}"
								update="navigationForm contentForm"
								styleClass="noUnderlineAtLink">
								<h:outputLabel value="#{task.taskID}" />

								<!-- new task -->
								<h:panelGroup rendered="#{task.isNew()}">
									<i style="margin-left: 5px;" class="fa fa-child icon-green"
										title="#{msg['body.worklist.navigation.activtasks.new']}" />
								</h:panelGroup>
								<!-- staining needed -->
								<h:panelGroup
									rendered="#{task.isStainingNeeded() or task.isReStainingNeeded()}">
									<i style="margin-left: 5px;"
										class="fa fa-image #{task.isStainingNeeded() ? 'icon-green' : 'icon-orange'}"
										title="#{task.isStainingNeeded() eq true ? msg['body.worklist.navigation.activtasks.staining'] : msg['body.worklist.navigation.activtasks.restaining']}" />
								</h:panelGroup>
								<!-- diagnosis needed -->
								<h:panelGroup
									rendered="#{task.isStainingPerformed() and (task.isDiagnosisNeeded() or task.isReDiagnosisNeeded())}">
									<i style="margin-left: 5px;"
										class="fa fa-eye #{task.isDiagnosisNeeded() ? 'icon-green' : 'icon-orange'}"
										title="#{task.isDiagnosisNeeded() ? msg['body.worklist.navigation.activtasks.diagnosis'] : msg['body.worklist.navigation.activtasks.rediagnosis'] }" />
								</h:panelGroup>
							</p:commandLink>
							<br />
						</p:repeat>

					</p:column>
				</p:row>
			</p:panelGrid>
		</p:column>

	</p:dataTable>

	<p:contextMenu for="patientList">
		<p:menuitem value="Entfernen" icon="ui-icon-close"
			actionListener="#{worklistHandlerAction.removeFromWorklist(worklistHandlerAction.selectedPatient)}"
			update="navigationForm contentForm" />
	</p:contextMenu>

	<p:overlayPanel for="navigationForm:patientList:listOrder"
		dynamic="true" style="width:600px">

		<p:selectOneRadio id="customRadio" value="#{radioView.color}"
			layout="custom">
			<f:selectItem itemLabel="Red" itemValue="Red" />
			<f:selectItem itemLabel="Green" itemValue="Green" />
			<f:selectItem itemLabel="Blue" itemValue="Blue" />
		</p:selectOneRadio>

		<h:panelGrid columns="3" cellpadding="5">
			<p:radioButton id="opt1" for="customRadio" itemIndex="0" />
			<h:outputLabel for="opt1" value="Red" />
			<p:spinner />

			<p:radioButton id="opt2" for="customRadio" itemIndex="1" />
			<h:outputLabel for="opt2" value="Green" />
			<p:inputText />

			<p:radioButton id="opt3" for="customRadio" itemIndex="2" />
			<h:outputLabel for="opt3" value="Blue" />
			<p:calendar />
		</h:panelGrid>

	</p:overlayPanel>


</ui:composition>
