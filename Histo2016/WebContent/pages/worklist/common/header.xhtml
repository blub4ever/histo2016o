<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


	<c:set var="selectedPatient"
		value="#{worklistHandlerAction.selectedPatient}" />

	<c:set var="selectedTask"
		value="#{worklistHandlerAction.selectedPatient.selectedTask}" />

	<c:set var="taskEditable" scope="request"
		value="#{taskHandlerAction.isTaskEditable(selectedTask)}" />

	<c:set var="patientIsNotNull" scope="request"
		value="#{selectedPatient ne null}" />

	<c:set var="taskIsNotNull" scope="request"
		value="#{selectedPatient ne null and selectedTask ne null }" />

	<c:set var="stainingStatus" scope="request"
		value="#{selectedTask.stainingStatus}" />

	<c:set var="diagnosisStatus" scope="request"
		value="#{selectedTask.diagnosisStatus}" />

	<h:panelGrid columns="2"
		styleClass="noBordersAll collapsedBordersAll noPaddingAll"
		style="width:100%">
		<h:panelGrid columns="4">

			<p:selectBooleanCheckbox
				value="#{worklistHandlerAction.filterWorklist}" disabled="true" />
			<h:outputLabel value="#{msg['body.worklist.header.filter']}" />

			<p:commandButton
				value="#{msg['body.worklist.header.button.addPatient']}"
				styleClass="buttonMarginLeft"
				actionListener="#{patientHandlerAction.showAndInitAddPatientDialog()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<p:selectOneMenu style="margin-top:1px;"
				title="#{msg['body.worklist.header.view']}"
				value="#{mainHandlerAction.currentView}">

				<f:selectItems value="#{mainHandlerAction.navigationPages}"
					var="page" itemLabel="#{msg['enum.pages.'.concat(page)]}" />

				<p:ajax event="change"
					oncomplete="$('#headerForm\\:changeView').click();"></p:ajax>

			</p:selectOneMenu>

			<p:commandButton id="changeView" ajax="false"
				action="#{mainHandlerAction.goToNavigation(mainHandlerAction.currentView)}"
				style="display:none" />
		</h:panelGrid>

		<!-- Buttons on the right -->
		<h:panelGroup styleClass="headerRight" layout="block">

			<!-- Current Version -->
			<p:commandLink
				value="Version : #{mainHandlerAction.settings.currentVersion}"
				styleClass="noUnderlineAtLink buttonRighMarginInListExtended icon-grey"
				actionListener="#{maintenanceHandlerAction.prepareInfoDialog()}"></p:commandLink>

			<!-- button edit -->
			<p:commandButton id="dynaButton" value="#{msg['header.menu.edit']}"
				type="button" icon="ui-icon-triangle-1-s"
				styleClass="buttonRighMarginInList" />

			<!-- Options menu -->
			<p:tieredMenu overlay="true" trigger="dynaButton" my="left top"
				at="left bottom" id="tieredOptions">

				<!-- Patient -->
				<p:submenu label="#{msg['header.menu.patient']}">

					<!-- add Patient -->
					<p:menuitem value="#{msg['header.menu.patient.new']}"
						icon="fa fa-user"
						onclick="$('#headerForm\\:addPatient').click();$('#headerForm\\:tieredOptions').hide();return false;" />

					<p:separator
						rendered="#{worklistHandlerAction.selectedPatient ne null}" />

					<!-- Overview, rendered if selected patient is not null -->
					<p:menuitem value="#{msg['header.menu.patient.overview']}" icon="fa fa-tablet"
						onclick="$('#headerForm\\:showPatientOverview').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{patientIsNotNull}" />

					<!-- edit patient, rendered if selected patient is not null, disabled  if patient is not extern -->
					<p:menuitem value="#{msg['header.menu.patient.edit']}"
						icon="fa fa-pencil-square-o"
						title="#{!worklistHandlerAction.selectedPatient.externalPatient ? msg['header.menu.patient.edit.disabled'] : ''}"
						disabled="#{!worklistHandlerAction.selectedPatient.externalPatient}"
						onclick="$('#headerForm\\:editPatientData').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{patientIsNotNull}" />

					<!-- upload to patient -->
					<p:menuitem value="#{msg['header.menu.patient.upload']}"
						icon="fa fa-cloud-upload"
						onclick="$('#headerForm\\:uploadBtnToPatient').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{patientIsNotNull}" />
				</p:submenu>

				<!-- Task -->
				<p:submenu label="#{msg['header.menu.task']}"
					rendered="#{selectedPatient ne null}">
					<!-- ************ Task ************ -->
					<!-- New Task, rendered if selected patient not null -->
					<p:menuitem value="#{msg['header.menu.task.create']}"
						icon="fa fa-plus"
						onclick="$('#headerForm\\:newTaskBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{patientIsNotNull}" />

					<!-- New Sample, rendered if selected patient is not null, disabled if no task was selected -->
					<p:menuitem value="#{msg['header.menu.task.sample.create']}"
						icon="fa fa-plus"
						onclick="$('#headerForm\\:newSampleBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						disabled="#{!taskIsNotNull or !taskEditable}"
						rendered="#{patientIsNotNull}"
						title="#{!taskIsNotNull ? msg['header.menu.task.selectTaskFirst'] : ''}" />
					<!-- ************ Task ************ -->

					<!-- ************ Staining ************ -->
					<p:separator rendered="#{taskIsNotNull}" />
					<!-- New Slides -->
					<p:menuitem value="#{msg['header.menu.task.sample.newSlide']}"
						disabled="#{true}" icon="fa fa-fw fa-image"
						rendered="#{taskIsNotNull}" />

					<!-- Staining, add to staining phase, if all staining tasks have been completed-->
					<p:menuitem
						value="#{msg['header.menu.task.sample.stainingPhase.add']}"
						disabled="#{!taskEditable}" icon="fa fa-fw fa-image"
						onclick="$('#headerForm\\:stainingPhaseForce').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{taskIsNotNull and !selectedTask.stainingPhase}" />

					<!-- Staining, end staining phase if all staining tasks have been completed-->
					<p:menuitem
						value="#{msg['header.menu.task.sample.stainingPhase.end']}"
						icon="fa fa-fw fa-image"
						onclick="$('#headerForm\\:stainingPhaseEndManual').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{taskIsNotNull and selectedTask.stainingPhase and stainingStatus eq 'PERFORMED'}" />

					<!-- Diagnosis, force diagnosis phase if not all staining tasks have been completed -->
					<p:menuitem disabled="#{!taskEditable}"
						value="#{msg['header.menu.task.sample.diangosisPhase.add']}"
						icon="fa fa-fw fa-image"
						onclick="$('#headerForm\\:diagnosisPhaseForceFromStaining').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{taskIsNotNull and stainingStatus ne 'PERFORMED' and !selectedTask.diagnosisPhase}" />
					<!-- ************ Staining ************ -->

					<!-- ************ Diagnosis ************ -->
					<p:separator />

					<!-- New Diagnosis revision-->
					<p:menuitem icon="fa fa-pencil-square-o"
						value="#{msg['header.menu.task.sample.diagnosisRevion']}"
						disabled="#{!taskEditable}" rendered="#{taskIsNotNull}"
						onclick="$('#headerForm\\:newDiagnosisRevision').click();$('#headerForm\\:tieredOptions').hide();return false;" />

					<!-- Remove if locked -->
					<p:menuitem icon="fa fa-pencil-square-o"
						value="#{msg['header.menu.task.sample.diagnosisPhase.remove']}"
						rendered="#{taskIsNotNull and diagnosisStatus eq 'PERFORMED' and selectedTask.diagnosisPhase}"
						onclick="$('#headerForm\\:diagnosisPhaseEndManual').click();$('#headerForm\\:tieredOptions').hide();return false;" />

					<!-- Lock diagnosis -->
					<p:menuitem icon="fa fa-pencil-square-o"
						value="#{msg['header.menu.task.sample.diagnosisPhase.lock']}"
						disabled="#{!taskEditable}"
						rendered="#{taskIsNotNull and diagnosisStatus ne 'PERFORMED'}"
						onclick="$('#headerForm\\:diagnosisPhaseEndAuto').click();$('#headerForm\\:tieredOptions').hide();return false;" />

					<!-- Unlock -->
					<p:menuitem
						value="#{msg['header.menu.task.sample.diagnosisPhase.unlock']}"
						icon="fa fa-fw fa-image"
						onclick="$('#headerForm\\:diagnosisPhaseUnlock').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{taskIsNotNull and selectedTask.finalized}" />
					<p:separator />
					<!-- ************ Diagnosis ************ -->

					<!-- Contacts -->
					<p:menuitem value="#{msg['header.menu.task.sample.contact']}"
						icon="fa fa-envelope-o" disabled="#{!taskEditable}"
						rendered="#{worklistHandlerAction.selectedPatient ne null}"
						onclick="$('#headerForm\\:editContactBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						title="#{worklistHandlerAction.selectedPatient.selectedTask eq null ? msg['header.menu.task.selectTaskFirst'] : ''}" />

					<!-- notification -->
					<p:menuitem value="#{msg['header.menu.task.sample.notification']}"
						icon="fa fa-volume-up"
						disabled="#{worklistHandlerAction.selectedPatient.selectedTask eq null}"
						rendered="#{worklistHandlerAction.selectedPatient ne null}"
						onclick="$('#headerForm\\:notificationContactBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						title="#{worklistHandlerAction.selectedPatient.selectedTask eq null ? msg['header.menu.task.selectTaskFirst'] : ''}" />

					<!-- accounting -->
					<p:menuitem value="#{msg['header.menu.task.sample.accounting']}"
						icon="fa fa-dollar" disabled="true"
						rendered="#{worklistHandlerAction.selectedPatient ne null}"
						title="#{worklistHandlerAction.selectedPatient.selectedTask eq null ? msg['header.menu.task.selectTaskFirst'] : ''}" />

					<p:separator />

					<!-- council -->
					<p:menuitem value="#{msg['header.menu.task.council']}"
						disabled="#{!taskEditable}" icon="fa fa-comment-o"
						onclick="$('#headerForm\\:councilBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{worklistHandlerAction.selectedPatient ne null and worklistHandlerAction.selectedPatient.selectedTask ne null  }" />

					<!-- Print -->
					<p:menuitem value="#{msg['header.menu.task.sample.print']}"
						icon="fa fa-print"
						disabled="#{worklistHandlerAction.selectedPatient.selectedTask eq null}"
						rendered="#{worklistHandlerAction.selectedPatient ne null}"
						onclick="$('#headerForm\\:printBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						title="#{worklistHandlerAction.selectedPatient.selectedTask eq null ? msg['header.menu.task.selectTaskFirst'] : ''}" />

					<!-- upload -->
					<p:menuitem value="#{msg['header.menu.task.upload']}"
						icon="fa fa-cloud-upload"
						onclick="$('#headerForm\\:uploadBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
						rendered="#{worklistHandlerAction.selectedPatient ne null and worklistHandlerAction.selectedPatient.selectedTask ne null  }" />

				</p:submenu>

				<!-- Admin -->
				<p:submenu label="#{msg['header.menu.admin']}"
					rendered="#{userHandlerAction.currentUserHasRoleOrHigher('ADMIN')}">
					<p:menuitem value="#{msg['header.menu.admin.task']}"
						rendered="#{worklistHandlerAction.selectedPatient ne null and worklistHandlerAction.selectedPatient.selectedTask ne null  }"
						onclick="$('#headerForm\\:showAdministerTask').click();$('#headerForm\\:tieredOptions').hide();return false;" />

				</p:submenu>


				<!-- Log -->
				<p:menuitem value="#{msg['header.menu.log']}"
					onclick="$('#headerForm\\:logBtn').click();$('#headerForm\\:tieredOptions').hide();return false;"
					rendered="#{worklistHandlerAction.selectedPatient ne null}" />


			</p:tieredMenu>

			<!-- *************** Patient Menu *************** -->
			<!-- Show Patient Overview -->
			<p:commandButton id="addPatient" style="display:none"
				actionListener="#{patientHandlerAction.showAndInitAddPatientDialog()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>
			<!-- Show Overview -->
			<p:commandButton id="showPatientOverview" style="display:none"
				actionListener="#{worklistHandlerAction.onDeselectTask(worklistHandlerAction.selectedPatient)}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- upload button to patient -->
			<p:commandButton id="uploadBtnToPatient" style="display:none"
				actionListener="#{mediaHandlerAction.preparePatientDataUploadDialog(worklistHandlerAction.selectedPatient)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- Edit Patient data -->
			<p:commandButton id="editPatientData" style="display:none"
				actionListener="#{patientHandlerAction.prepareEditExternalPatientDialog(worklistHandlerAction.selectedPatient)}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- *************** Patient Menu *************** -->


			<!-- *************** Task Menu *************** -->

			<!-- New Task Button -->
			<p:commandButton id="newTaskBtn" style="display:none"
				actionListener="#{taskHandlerAction.prepareNewTaskDialog()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- New Sample -->
			<p:commandButton id="newSampleBtn" style="display:none"
				actionListener="#{taskHandlerAction.prepareNewSampleDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- Remove from staining list -->
			<p:commandButton id="stainingPhaseEndManual" style="display:none"
				actionListener="#{slideHandlerAction.showStaingPhaseEndManualDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Force add to staining list -->
			<p:commandButton id="stainingPhaseForce" style="display:none"
				actionListener="#{slideHandlerAction.showForceStainingPhaseDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Force add to diagnosis list from stainig list -->
			<p:commandButton id="diagnosisPhaseForceFromStaining"
				style="display:none"
				actionListener="#{stainingHandlerAction.showForceDiagnosisPhaseDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- New diagnosis revision -->
			<p:commandButton id="newDiagnosisRevision" style="display:none"
				actionListener="#{diagnosisHandlerAction.prepareDiagnosisRevisionDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Remove diagnosis from worklist if remained in worklist after finished -->
			<p:commandButton id="diagnosisPhaseEndManual" style="display:none"
				actionListener="#{diagnosisHandlerAction.showDiagnosisPhaseEndManual(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Lock diagnosis -->
			<p:commandButton id="diagnosisPhaseEndAuto" style="display:none"
				actionListener="#{diagnosisHandlerAction.showDiagnosisPhaseEndAutoDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Unlock diagnosis -->
			<p:commandButton id="diagnosisPhaseUnlock" style="display:none"
				actionListener="#{diagnosisHandlerAction.showUnlockDiagnosisPhaseDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>



			<!-- Contacts button -->
			<p:commandButton id="editContactBtn" style="display:none"
				actionListener="#{contactHandlerAction.prepareContactsDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn" update="contentForm" />
			</p:commandButton>

			<!-- Notification button -->
			<p:commandButton id="notificationContactBtn" style="display:none"
				actionListener="#{notificationHandlerAction.showinfoDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- Print button -->
			<p:commandButton id="printBtn" style="display:none"
				widgetVar="printBtnVar" onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				actionListener="#{printHandlerAction.showDefaultPrintDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- Council button -->
			<p:commandButton id="councilBtn" style="display:none"
				actionListener="#{taskHandlerAction.prepareCouncilDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- upload button -->
			<p:commandButton id="uploadBtn" style="display:none"
				actionListener="#{mediaHandlerAction.prepareMediaDisplayDialog(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>
			<!-- *************** Task Menu *************** -->

			<!-- *************** Admin Menu *************** -->
			<p:commandButton id="showAdministerTask" style="display:none"
				actionListener="#{taskHandlerAction.showAdministrateTask(worklistHandlerAction.selectedPatient.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>
			<!-- *************** Admin Menu *************** -->


			<!-- *************** Log Menu *************** -->
			<p:commandButton id="logBtn" style="display:none"
				actionListener="#{logHandlerAction.preparePatientLogDialog(worklistHandlerAction.selectedPatient)}">
				<p:ajax event="dialogReturn" update="contentForm" />
			</p:commandButton>
			<!-- *************** Log Menu *************** -->


			<!-- Menu Button -->
			<p:commandButton id="menuBtn" value="Menu" type="button"
				icon="ui-icon-triangle-1-s" />

			<!-- Menu Button over -->
			<p:tieredMenu overlay="true" trigger="menuBtn" my="left top"
				id="tiredMenu" at="left bottom" style="width:200px">

				<!-- s button -->
				<p:menuitem value="#{msg['body.worklist.header.button.settings']}"
					onclick="$('#headerForm\\:settingsDialogBtn').click();$('#headerForm\\:tiredMenu').hide();return false;" />

				<!-- notification -->
				<p:menuitem
					value="#{msg['body.worklist.header.button.userSettings']}"
					onclick="$('#headerForm\\:userSettingsDialogBtn').click();$('#headerForm\\:tiredMenu').hide();return false;" />

				<!-- info button -->
				<p:menuitem value="#{msg['body.worklist.header.button.info']}"
					onclick="$('#headerForm\\:infoDialogBtn').click();$('#headerForm\\:tiredMenu').hide();return false;" />

				<!-- notification -->
				<p:menuitem value="#{msg['body.worklist.header.button.logout']}"
					url="/spring_logout?faces-redirect=true" />
			</p:tieredMenu>

			<!-- settings button -->
			<p:commandButton id="settingsDialogBtn" style="display:none"
				actionListener="#{settingsHandlerAction.prepareSettingsDialog()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- userSettings button -->
			<p:commandButton id="userSettingsDialogBtn" style="display:none"
				actionListener="#{userHandlerAction.prepareUserSettingsDialog()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- Info button -->
			<p:commandButton id="infoDialogBtn" style="display:none"
				actionListener="#{maintenanceHandlerAction.prepareInfoDialog()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>




			<!-- show only button for print dialog, workaround for closing and showing dialogs -->
			<p:commandButton id="printBtnShowOnly" style="display:none"
				actionListener="#{printHandlerAction.showPrintDialog()}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- show only button for council dialog, workaround for closing and showing dialogs -->
			<p:commandButton id="councilBtnShowOnly" style="display:none"
				actionListener="#{mainHandlerAction.showDialog('COUNCIL')}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- show only button for notification dialog, workaround for closing and showing dialogs -->
			<p:commandButton id="notificationBtnShowOnly" style="display:none"
				actionListener="#{notificationHandlerAction.showinfoDialog(notificationHandlerAction.tmpTask, true)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.showQueueDialog()}" />
			</p:commandButton>

			<!-- Function for clicking on the dialogs -->
			<script type="text/javascript">
				// funktion is triggert by the backend to show a dialog, workaround
				function showDialogFromFrontendByBean(btn) {
					$(btn).click();
				}
			</script>
		</h:panelGroup>
	</h:panelGrid>
</ui:composition>
