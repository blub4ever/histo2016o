<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


	<c:set var="selectedPatient"
		value="#{globalEditViewHandler.selectedPatient}" />

	<c:set var="selectedTask" value="#{globalEditViewHandler.selectedTask}" />

	<c:set var="taskEditable" scope="session"
		value="#{taskStatusHandler.isTaskEditable(selectedTask)}" />

	<c:set var="patientIsNotNull" scope="request"
		value="#{selectedPatient ne null}" />

	<c:set var="taskIsNotNull" scope="request"
		value="#{selectedPatient ne null and selectedTask ne null }" />

	<h:panelGrid columns="2"
		styleClass="noBordersAll collapsedBordersAll noPaddingAll"
		style="width:100%">
		<h:panelGrid columns="4">

			<p:selectBooleanCheckbox value="" disabled="true" />
			<h:outputLabel value="#{msg['body.worklist.header.filter']}" />

			<p:commandButton
				value="#{msg['body.worklist.header.button.addPatient']}"
				styleClass="buttonMarginLeft"
				actionListener="#{dialogHandlerAction.addPatientDialogHandler.initAndPrepareBean()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<p:selectOneMenu style="margin-top:1px;"
				title="#{msg['body.worklist.header.view']}"
				value="#{worklistViewHandlerAction.currentView}">

				<f:selectItems value="#{globalEditViewHandler.navigationPages}"
					var="page" itemLabel="#{msg['enum.pages.'.concat(page)]}" />

				<p:ajax event="change" process="@this"
					oncomplete="$('#headerForm\\:changeView').click();"></p:ajax>

			</p:selectOneMenu>

			<p:commandButton id="changeView"
				update="navigationForm contentForm navigationForm"
				actionListener="#{worklistViewHandlerAction.goToNavigation()}"
				style="display:none" />

		</h:panelGrid>

		<!-- Buttons on the right -->
		<h:panelGroup styleClass="headerRight" layout="block">

			<!-- Current Version -->
			<p:commandLink value="Version : #{globalSettings.currentVersion}"
				styleClass="noUnderlineAtLink buttonRighMarginInListExtended icon-grey"
				actionListener="#{programmVersionDialog.initAndPrepareBean()}"></p:commandLink>

			<!-- button edit -->
			<p:commandButton id="taskMenuButton"
				value="#{msg['header.menu.edit']}" type="button"
				icon="ui-icon-triangle-1-s" styleClass="buttonRighMarginInList" />

			<!-- Options menu -->
			<p:tieredMenu overlay="true" trigger="taskMenuButton" my="left top"
				model="#{globalEditViewHandler.taskMenuModel}" at="left bottom"
				id="taskTieredMenuButton">
			</p:tieredMenu>

			<!-- *************** Patient Menu *************** -->
			<!-- Show Patient Overview -->
			<p:commandButton id="addPatientButton" style="display:none"
				actionListener="#{dialogHandlerAction.addPatientDialogHandler.initAndPrepareBean()}">
				<p:ajax event="dialogReturn" />
			</p:commandButton>

			<!-- Show Overview -->
			<p:commandButton id="showPatientOverview" style="display:none"
				update="navigationForm contentForm headerForm"
				actionListener="#{worklistViewHandlerAction.onDeselectTask()}">
			</p:commandButton>

			<!-- upload button to patient -->
			<p:commandButton id="uploadBtnToPatient" style="display:none"
				actionListener="#{patientViewHandlerAction.showPatientMediaDialog()}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- Edit Patient data -->
			<p:commandButton id="editPatientData" style="display:none"
				actionListener="#{dialogHandlerAction.editPatientDialog.initAndPrepareBean(globalEditViewHandler.selectedPatient)}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- *************** Patient Menu *************** -->


			<!-- *************** Task Menu *************** -->

			<!-- New Task Button -->
			<p:commandButton id="newTaskBtn" style="display:none"
				actionListener="#{dialogHandlerAction.createTaskDialog.initAndPrepareBean(globalEditViewHandler.selectedPatient)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Staining List, New Sample -->
			<p:commandButton id="newSampleBtn" style="display:none"
				actionListener="#{createSampleDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Staining overview -->
			<p:commandButton id="stainingOverview" style="display:none"
				actionListener="#{dialogHandlerAction.slideOverviewDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Staining List, leave phase an set all stainigs to performed -->
			<p:commandButton id="stainingPhaseExit" style="display:none"
				actionListener="#{dialogHandlerAction.stainingPhaseExitDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Staining List,  remove from  list stay in list -->
			<p:commandButton id="stainingPhaseForceExitStayInPhase"
				style="display:none"
				actionListener="#{dialogHandlerAction.stainingExitStayInPhaseDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Diagnosis List, new diagnosis revision -->
			<p:commandButton id="newDiagnosisRevision" style="display:none"
				actionListener="#{diagnosisRevisionDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Diagnosis List, leave diagnosis phase after completion -->
			<p:commandButton id="diagnosisPhaseExit" style="display:none"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				actionListener="#{dialogHandlerAction.diagnosisPhaseExitDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Diagnosis List, force leave diagnosis phase, if still in diagnosis phase after diagnosis completion -->
			<p:commandButton id="diagnosisExitStayInPhase" style="display:none"
				actionListener="#{dialogHandlerAction.diagnosisExitStayInPhaseDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Un finalize Diagnosis -->
			<p:commandButton id="diagnosisPhaseUnFinalize" style="display:none"
				actionListener="#{dialogHandlerAction.diagnosisUnFinalizeDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Council button -->
			<p:commandButton id="councilBtn" style="display:none"
				actionListener="#{councilDialogHandler.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- Contacts button -->
			<p:commandButton id="editContactBtn" style="display:none"
				actionListener="#{dialogHandlerAction.contactDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm" />
			</p:commandButton>

			<!-- Notification button -->
			<p:commandButton id="notificationContactBtn" style="display:none"
				actionListener="#{notificationHandlerAction.showinfoDialog(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- MedicalFindings button -->
			<p:commandButton id="medicalFindingsContactBtn" style="display:none"
				actionListener="#{dialogHandlerAction.notificationDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- Favourite-Lists button -->
			<p:commandButton id="favouriteListsBtn" style="display:none"
				actionListener="#{dialogHandlerAction.favouriteListsDialog.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- Biobank button -->
			<p:commandButton id="bioBankBtn" style="display:none"
				actionListener="#{bioBankDialogHandler.initAndPrepareBean(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- Print button -->
			<p:commandButton id="printBtn" style="display:none"
				widgetVar="printBtnVar" onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				actionListener="#{dialogHandlerAction.printDialog.initAndPrepareBeanForPrinting(globalEditViewHandler.selectedTask)}">
				<p:ajax event="dialogReturn"
					update="navigationForm contentForm headerForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- upload button -->
			<p:commandButton id="uploadBtn" style="display:none"
				actionListener="#{patientViewHandlerAction.showTaskMediaDialog()}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>
			<!-- *************** Task Menu *************** -->

			<!-- *************** Log Menu *************** -->
			<p:commandButton id="logBtn" style="display:none"
				actionListener="#{dialogHandlerAction.patientLogDialog.initAndPrepareBean(globalEditViewHandler.selectedPatient)}">
				<p:ajax event="dialogReturn" update="contentForm" />
			</p:commandButton>
			<!-- *************** Log Menu *************** -->


			<!-- Menu Button -->
			<p:commandButton id="menuBtn" value="Menu" type="button"
				icon="ui-icon-triangle-1-s" />

			<!-- Menu Button over -->
			<p:tieredMenu overlay="true" trigger="menuBtn" my="left top"
				id="tiredMenu" at="left bottom" style="width:200px">

				<!-- settings button -->
				<p:menuitem value="#{msg['body.worklist.header.button.settings']}"
					rendered="#{userHandlerAction.currentUserHasPermission('SHOW_SETTINGS_DIALOG')}"
					onclick="$('#headerForm\\:settingsDialogBtn').click();$('#headerForm\\:tiredMenu').hide();return false;" />

				<!-- notification -->
				<p:menuitem
					value="#{msg['body.worklist.header.button.userSettings']}"
					onclick="$('#headerForm\\:userSettingsDialogBtn').click();$('#headerForm\\:tiredMenu').hide();return false;" />

				<!-- info button -->
				<p:menuitem value="#{msg['body.worklist.header.button.info']}"
					onclick="$('#headerForm\\:infoDialogBtn').click();$('#headerForm\\:tiredMenu').hide();return false;" />

				<!-- notification -->
				<p:menuitem value="#{msg['body.worklist.header.button.logout']}"
					url="/spring_logout?faces-redirect=true" />
			</p:tieredMenu>

			<!-- settings button -->
			<p:commandButton id="settingsDialogBtn" style="display:none"
				partialSubmit="true" process="@this"
				actionListener="#{settingsDialogHandler.initAndPrepareBean()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- userSettings button -->
			<p:commandButton id="userSettingsDialogBtn" style="display:none"
				actionListener="#{userSettingsDialog.initAndPrepareBean()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- Info button -->
			<p:commandButton id="infoDialogBtn" style="display:none"
				actionListener="#{programmVersionDialog.initAndPrepareBean()}">
				<p:ajax event="dialogReturn" update="navigationForm contentForm" />
			</p:commandButton>

			<!-- show only button for print dialog, workaround for closing and showing dialogs -->
			<p:commandButton id="printBtnShowOnly" style="display:none"
				actionListener="#{mainHandlerAction.showDialog('PRINT')}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- show only button for council dialog, workaround for closing and showing dialogs -->
			<p:commandButton id="councilBtnShowOnly" style="display:none"
				actionListener="#{mainHandlerAction.showDialog('COUNCIL')}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- show only button for notification dialog, workaround for closing and showing dialogs -->
			<p:commandButton id="notificationBtnShowOnly" style="display:none"
				actionListener="#{notificationHandlerAction.showinfoDialog(notificationHandlerAction.tmpTask, true)}">
				<p:ajax event="dialogReturn" update="contentForm"
					listener="#{mainHandlerAction.processQueues()}" />
			</p:commandButton>

			<!-- update all -->
			<p:commandButton id="updateAllContent" style="display:none"
				actionListener="#{mainHandlerAction.showQueueGrowlMessage()}"
				update="navigationForm contentForm headerForm growlForm:globalgrowl" />


			<!-- Function for clicking on the dialogs -->
			<script type="text/javascript">
				// funktion is triggert by the backend to show a dialog, workaround
				function clickButtonFromBean(btn) {
					$(btn).click();
				}
			</script>
		</h:panelGroup>
	</h:panelGrid>
</ui:composition>
