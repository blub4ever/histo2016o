<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<!-- Search -->
	<h:panelGroup styleClass="searchContainer" layout="block">
		<p:focus context="form" for="searchField" />
		<p:inputText placeholder="#{msg.headSearch}" id="searchField"
			styleClass="seachFiled"
			value="#{worklistHandlerAction.worklistFilter}">
			<p:ajax event="keyup"
				listener="#{worklistHandlerAction.searchForExistingPatients()}" />
		</p:inputText>
	</h:panelGroup>

	<!-- Nav Table -->
	<p:dataTable var="patient" id="patientList"
		value="#{worklistHandlerAction.workList}" selectionMode="single"
		selection="#{worklistHandlerAction.selectedPatient}"
		rowKey="#{patient.id}" styleClass="navTable">

		<p:ajax event="rowSelect"
			update=":contentForm :headerForm :navigationForm"
			listener="#{worklistHandlerAction.onSelectPatient(worklistHandlerAction.selectedPatient)}" />

		<p:column>
			<!-- Header -->
			<f:facet name="header">
				<h:panelGroup layout="block">
					<h:outputLabel value="#{msg['body.worklist.navigation.headline']}"
						style="float:left;"></h:outputLabel>
					<h:panelGroup style="float: right">
						<!-- Button UP -->
						<p:commandLink
							title="#{msg['body.worklist.navigation.button.up']}"
							actionListener="#{worklistHandlerAction.selectPreviouseTask()}"
							update="navigationForm contentForm">
							<i class="fa fa-arrow-circle-up"></i>
						</p:commandLink>

						<!-- Button Down -->
						<p:commandLink
							title="#{msg['body.worklist.navigation.button.down']}"
							actionListener="#{worklistHandlerAction.selectNextTask()}"
							update="navigationForm contentForm">
							<i class="fa fa-arrow-circle-down"></i>
						</p:commandLink>

						<!-- Button Sort -->
						<p:commandLink
							title="#{msg['body.worklist.navigation.button.sort']}"
							actionListener="#{mainHandlerAction.showDialog(enumProvider.getDialog('WORKLIST_ORDER'))}">
							<i class="fa fa-th-list"></i>
							<p:ajax event="dialogReturn" update="navigationForm contentForm" />
						</p:commandLink>

						<!-- Worklist settings -->
						<p:commandLink
							title="#{msg['body.worklist.navigation.button.sort']}"
							actionListener="#{mainHandlerAction.showDialog(enumProvider.getDialog('WORKLIST_SETTINGS'))}">
							<i class="fa fa-wrench"></i>
							<p:ajax event="dialogReturn" update="navigationForm contentForm" />
						</p:commandLink>

						<!-- Worklist change -->
						<p:commandLink
							title="#{msg['body.worklist.navigation.button.changelist']}"
							actionListener="#{mainHandlerAction.showDialog(enumProvider.getDialog('WORKLIST_SEARCH'))}">
							<i class="fa fa-search"></i>
							<p:ajax event="dialogReturn" update="navigationForm contentForm" />
						</p:commandLink>
					</h:panelGroup>
				</h:panelGroup>
			</f:facet>

			<!-- Data -->
			<p:panelGrid styleClass="contentTable noBordersAll">

				<p:row>
					<p:column>
						<h:outputText
							value="#{patient.person.name}, #{patient.person.surname}" />
					</p:column>
					<p:column>
						<h:outputText
							value="PIZ: #{patient.piz ne 0 ? patient.piz : 'none'}" />
					</p:column>
				</p:row>
				<p:row>
					<p:column>
						<h:outputLabel
							value="#{mainHandlerAction.date(patient.person.birthday)}"
							rendered="#{patient.person.birthday ne null}" />
					</p:column>
					<p:column>
					</p:column>
				</p:row>

				<!-- Active Tasks -->
				<p:row>
					<p:column style="vertical-align: top !important;">
						<h:outputLabel
							value="#{msg['body.worklist.navigation.activtasks']}" />
					</p:column>
					<p:column>
						<!-- no tasks -->
						<h:outputLabel rendered="#{patient.activTasks.size() eq 0}"
							value="#{msg['body.worklist.navigation.activtasks.none']}"></h:outputLabel>

						<!-- task list -->
						<p:repeat var="task" value="#{patient.activTasks}">
							<p:commandLink
								actionListener="#{worklistHandlerAction.onSelectTaskAndPatient(task)}"
								update="navigationForm contentForm headerForm"
								styleClass="noUnderlineAtLink">

								<h:outputLabel value="#{task.taskID}"
									style="#{worklistHandlerAction.selectedPatient.selectedTask eq task ? 'text-decoration: underline;' : ''}" />

								<!-- priority -->
								<h:panelGroup rendered="#{task.taskPriority ne 'LOW'}">
									<i style="margin-left: 5px;"
										class="fa fa-exclamation #{task.taskPriority eq 'MEDIUM' ? 'icon-orange' : 'icon-red'}"
										title="#{msg['body.worklist.navigation.activtasks.new']}" />
								</h:panelGroup>

								<!-- new task -->
								<h:panelGroup
									rendered="#{task.isNew()}">
									<i style="margin-left: 5px;" class="fa fa-child icon-green"
										title="#{msg['body.worklist.navigation.activtasks.new']}" />
								</h:panelGroup>

								<!-- staining needed -->
								<h:panelGroup
									rendered="#{task.getStainingStatus() eq 'STAINING_NEEDED'  or task.getStainingStatus() eq 'RE_STAINING_NEEDED'}">
									<i style="margin-left: 5px;"
										class="fa fa-image #{task.getStainingStatus() eq 'STAINING_NEEDED'  ? 'icon-green' : 'icon-orange'}"
										title="#{task.getStainingStatus() eq 'STAINING_NEEDED' ? msg['body.worklist.navigation.activtasks.staining'] : msg['body.worklist.navigation.activtasks.restaining']}" />
								</h:panelGroup>

								<!-- diagnosis needed -->
								<h:panelGroup
									rendered="#{task.getStainingStatus() eq 'PERFORMED' and (task.getDiagnosisStatus() eq 'DIAGNOSIS_NEEDED' or task.getDiagnosisStatus() eq 'RE_DIAGNOSIS_NEEDED')}">
									<i style="margin-left: 5px;"
										class="fa fa-eye #{task.getDiagnosisStatus() eq 'DIAGNOSIS_NEEDED' ? 'icon-green' : 'icon-orange'}"
										title="#{task.getDiagnosisStatus() eq 'DIAGNOSIS_NEEDED' ? msg['body.worklist.navigation.activtasks.diagnosis'] : msg['body.worklist.navigation.activtasks.rediagnosis'] }" />
								</h:panelGroup>

								<!-- Pendings completed -->
								<h:panelGroup
									rendered="#{(task.getDiagnosisStatus() eq 'PERFORMED')}">
									<i style="margin-left: 5px;"
										class="fa fa-check-circle "
										title="#{msg['body.worklist.navigation.activtasks.pendencies']}" />
								</h:panelGroup>

							</p:commandLink>
							<br />
						</p:repeat>

					</p:column>
				</p:row>	

				<!-- Non active Tasks -->
				<p:row
					rendered="#{patient.noneActivTasks ne null and worklistHandlerAction.sortOptions.showAllTasks}">
					<p:column style="vertical-align: top !important;">
						<h:outputLabel value="#{msg['body.worklist.navigation.tasks']}" />
					</p:column>
					<p:column>
						<!-- task list -->
						<p:repeat var="task" value="#{patient.noneActivTasks}">
							<p:commandLink
								actionListener="#{worklistHandlerAction.onSelectTaskAndPatient(task)}"
								update="navigationForm contentForm headerForm"
								styleClass="noUnderlineAtLink">
								<h:outputLabel value="#{task.taskID}"
									style="#{worklistHandlerAction.selectedPatient.selectedTask eq task ? 'text-decoration: underline;' : ''}" />
							</p:commandLink>
							<br />
						</p:repeat>

					</p:column>
				</p:row>
			</p:panelGrid>
		</p:column>

	</p:dataTable>

	<p:contextMenu for="patientList">
		<p:menuitem value="Entfernen" icon="ui-icon-close"
			actionListener="#{worklistHandlerAction.removeFromWorklist(worklistHandlerAction.selectedPatient)}"
			update="navigationForm contentForm" />
	</p:contextMenu>
</ui:composition>

