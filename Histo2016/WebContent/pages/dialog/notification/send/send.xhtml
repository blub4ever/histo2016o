<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<script type="text/javascript">
		function handleComplete(xhr, status, args) {
			var hasEnded = args.hasEnded;

			if (hasEnded == true) {
				PF('blockUIWidget').unblock();
				updateContent();
			}

		}
	</script>


	<div class="contentDiv">
		<p:panel style="width:100%;" styleClass="contentPannel">
			<f:facet name="header">
				<h:outputLabel
					value="#{msg['dialog.notification.tab.send.headline']}"></h:outputLabel>
			</f:facet>
		</p:panel>

		<p:scrollPanel style="width:100%;height:450px">

			<!-- ****************************** email ****************************** -->
			<p:panelGrid columns="1" styleClass="defaultListingTableContainer"
				style="width:100%;margin-top:10px;" id="mailTable">
				<p:panelGrid columns="2"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%">
					<h:panelGroup>
						<h:outputText
							value="#{msg['dialog.notification.tab.send.email']}: "
							styleClass="bold-text" />

						<!-- enable -->
						<ui:fragment
							rendered="#{dialogHandlerAction.notificationDialog.mailTab.useTab}">
							<i class="fa fa-fw fa-check-circle icon-green"
								title="#{msg['dialog.notification.notifiy.email.enabled']}" />
						</ui:fragment>
						<!-- disable -->
						<ui:fragment
							rendered="#{!dialogHandlerAction.notificationDialog.mailTab.useTab}">
							<i class="fa fa-fw fa-times-circle icon-red"
								title="#{msg['dialog.notification.notifiy.email.disabled']}" />
						</ui:fragment>
					</h:panelGroup>
				</p:panelGrid>

				<p:panelGrid columns="1"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%">
					<p:dataTable var="emailHolder"
						styleClass="noBordersAll collapsedBordersAll hide-column-names"
						value="#{dialogHandlerAction.notificationDialog.mailTab.holders}">

						<!-- name and email -->
						<p:column>
							<h:outputLabel
								value="#{emailHolder.contact.person.fullName} (#{emailHolder.contactAddress})"></h:outputLabel>

							<!-- Warning -->
							<ui:fragment
								rendered="#{!emailHolder.faildPreviously and emailHolder.warning}">
								<i class="fa fa-fw fa-exclamation-circle icon-orange"
									title="#{emailHolder.warningInfo}" />
							</ui:fragment>

							<!-- Warning -->
							<ui:fragment rendered="#{emailHolder.faildPreviously}">
								<i class="fa fa-fw fa-exclamation-circle icon-red"
									title="#{msg['dialog.medicalFindings.tab.notify.failed']} (emailHolder.notification.commentary)" />
							</ui:fragment>

						</p:column>

						<!-- performed -->
						<p:column style="width: 5%">
							<ui:fragment
								rendered="#{!emailHolder.faildPreviously and emailHolder.notification.performed and !emailHolder.notification.failed}">
								<i class="fa fa-fw fa-check-circle icon-green" />
							</ui:fragment>

							<ui:fragment
								rendered="#{!emailHolder.faildPreviously and emailHolder.notification.performed and emailHolder.notification.failed}">
								<i class="fa fa-fw fa-times-circle icon-red"
									title="#{emailHolder.notification.commentary}" />
							</ui:fragment>
						</p:column>
					</p:dataTable>
				</p:panelGrid>

			</p:panelGrid>

			<!-- ****************************** fax ****************************** -->
			<p:panelGrid columns="1" styleClass="defaultListingTableContainer"
				style="width:100%" id="faxTable">

				<p:panelGrid columns="2"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%">
					<h:panelGroup>
						<h:outputText value="#{msg['dialog.notification.notifiy.fax']}: "
							styleClass="bold-text" />

						<!-- active -->
						<ui:fragment
							rendered="#{dialogHandlerAction.notificationDialog.faxTab.useTab}">
							<i class="fa fa-fw fa-check-circle icon-green"
								title="#{msg['dialog.notification.notifiy.fax.enabled']}" />
						</ui:fragment>

						<!-- inactive -->
						<ui:fragment
							rendered="#{!dialogHandlerAction.notificationDialog.faxTab.useTab}">
							<i class="fa fa-fw fa-times-circle icon-red"
								title="#{msg['dialog.notification.notifiy.fax.disabled']}" />
						</ui:fragment>
					</h:panelGroup>
				</p:panelGrid>

				<p:panelGrid columns="1"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%">
					<p:dataTable var="faxHolder"
						styleClass="noBordersAll collapsedBordersAll hide-column-names"
						value="#{dialogHandlerAction.notificationDialog.faxTab.holders}">

						<!-- name and fax -->
						<p:column>
							<h:outputLabel
								value="#{faxHolder.contact.person.fullName} (#{faxHolder.contactAddress})"></h:outputLabel>

							<!-- Warning -->
							<ui:fragment
								rendered="#{!faxHolder.faildPreviously and faxHolder.warning}">
								<i class="fa fa-fw fa-exclamation-circle icon-orange"
									title="#{faxHolder.warningInfo}" />
							</ui:fragment>

							<!-- Warning -->
							<ui:fragment rendered="#{faxHolder.faildPreviously}">
								<i class="fa fa-fw fa-exclamation-circle icon-red"
									title="#{msg['dialog.medicalFindings.tab.notify.failed']} (#{faxHolder.notification.commentary})" />
							</ui:fragment>
						</p:column>

						<!-- performed -->
						<p:column style="width: 5%">
							<ui:fragment
								rendered="#{!faxHolder.faildPreviously and faxHolder.notification.performed and !faxHolder.notification.failed}">
								<i class="fa fa-fw fa-check-circle icon-green" />
							</ui:fragment>

							<ui:fragment
								rendered="#{!faxHolder.faildPreviously and  faxHolder.notification.performed and faxHolder.notification.failed}">
								<i class="fa fa-fw fa-times-circle icon-red"
									title="#{faxHolder.notification.commentary}" />
							</ui:fragment>
						</p:column>

					</p:dataTable>
				</p:panelGrid>
			</p:panelGrid>

			<!-- ****************************** letter ****************************** -->
			<p:panelGrid columns="1" styleClass="defaultListingTableContainer"
				style="width:100%" id="letterTable">

				<p:panelGrid columns="2"
					styleClass="noBordersAll collapsedBordersAll hide-column-names"
					style="width:100%">
					<h:panelGroup>
						<h:outputText
							value="#{msg['dialog.notification.notifiy.letter']}: "
							styleClass="bold-text" />

						<!-- active -->
						<ui:fragment
							rendered="#{dialogHandlerAction.notificationDialog.letterTab.useTab}">
							<i class="fa fa-fw fa-check-circle icon-green"
								title="#{msg['dialog.notification.notifiy.letter.enabled']}" />
						</ui:fragment>

						<!-- inactive -->
						<ui:fragment
							rendered="#{!dialogHandlerAction.notificationDialog.letterTab.useTab}">
							<i class="fa fa-fw fa-times-circle icon-red"
								title="#{msg['dialog.notification.notifiy.letter.disabled']}" />
						</ui:fragment>
					</h:panelGroup>
				</p:panelGrid>

				<p:panelGrid columns="1"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%">
					<p:dataTable var="letterHolder"
						styleClass="noBordersAll collapsedBordersAll hide-column-names"
						value="#{dialogHandlerAction.notificationDialog.letterTab.holders}">

						<!-- name -->
						<p:column>
							<h:outputLabel value="#{letterHolder.contact.person.fullName}" />

							<!-- Warning -->
							<ui:fragment rendered="#{!letterHolder.faildPreviously and letterHolder.warning}">
								<i class="fa fa-fw fa-exclamation-circle icon-orange"
									title="#{letterHolder.warningInfo}" />
							</ui:fragment>

							<!-- Warning -->
							<ui:fragment rendered="#{letterHolder.faildPreviously}">
								<i class="fa fa-fw fa-exclamation-circle icon-red"
									title="#{msg['dialog.medicalFindings.tab.notify.failed']} (#{letterHolder.notification.commentary})" />
							</ui:fragment>
						</p:column>

						<!-- performed -->
						<p:column style="width: 5%">
							<ui:fragment
								rendered="#{!letterHolder.faildPreviously and letterHolder.notification.performed and !letterHolder.notification.failed}">
								<i class="fa fa-fw fa-check-circle icon-green" />
							</ui:fragment>

							<ui:fragment
								rendered="#{!letterHolder.faildPreviously and letterHolder.notification.performed and letterHolder.notification.failed}">
								<i class="fa fa-fw fa-times-circle icon-red"
									title="#{letterHolder.notification.commentary}" />
							</ui:fragment>
						</p:column>
					</p:dataTable>
				</p:panelGrid>
			</p:panelGrid>

			<!-- ****************************** phone ****************************** -->
			<p:panelGrid columns="1" styleClass="defaultListingTableContainer"
				style="width:100%" id="phoneTable">

				<p:panelGrid columns="2"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%"
					columnClasses="defaultListingTableColumn150px, ">
					<h:panelGroup>
						<h:outputText
							value="#{msg['dialog.notification.notifiy.phone']}: "
							styleClass="bold-text" />

						<!-- active -->
						<ui:fragment
							rendered="#{dialogHandlerAction.notificationDialog.phoneTab.useTab}">
							<i class="fa fa-fw fa-check-circle icon-green"
								title="#{msg['dialog.notification.notifiy.phone.enabled']}" />
						</ui:fragment>
						<!-- inactive -->
						<ui:fragment
							rendered="#{!dialogHandlerAction.notificationDialog.phoneTab.useTab}">
							<i class="fa fa-fw fa-times-circle icon-red"
								title="#{msg['dialog.notification.notifiy.phone.disabled']}" />
						</ui:fragment>
					</h:panelGroup>
				</p:panelGrid>

				<p:panelGrid columns="1"
					styleClass="noBordersAll collapsedBordersAll" style="width:100%">
					<p:dataTable var="phoneHolder"
						styleClass="noBordersAll collapsedBordersAll hide-column-names"
						value="#{dialogHandlerAction.notificationDialog.phoneTab.holders}">
						<p:column>
							<!-- name -->
							<h:outputLabel
								value="#{phoneHolder.contact.person.fullName} (#{phoneHolder.contactAddress})" />

							<!-- Warning -->
							<ui:fragment rendered="#{phoneHolder.warning}">
								<i class="fa fa-fw fa-exclamation-circle icon-orange"
									title="#{phoneHolder.warningInfo}" />
							</ui:fragment>
						</p:column>
					</p:dataTable>
				</p:panelGrid>
			</p:panelGrid>
		</p:scrollPanel>

		<p:panelGrid columns="1" styleClass="defaultListingTableContainer"
			style="width:100%;">

			<h:outputText
				value="#{dialogHandlerAction.notificationDialog.sendTab.progressText} (#{dialogHandlerAction.notificationDialog.sendTab.progressPercent}%)"
				id="progressLable"
				style="border: 1px solid; width:90%;display:block; text-align:center; background: linear-gradient(90deg, #fcf1b8 #{dialogHandlerAction.notificationDialog.sendTab.progressPercent}%, transparent 0%);margin: 0px auto;" />

			<p:poll autoStart="false" widgetVar="ajaxProgressPoll"
				stop="#{dialogHandlerAction.notificationDialog.sendTab.notificationCompleted}"
				partialSubmit="true"
				update="progressLable mailTable faxTable phoneTable letterTable"
				interval="1" oncprocess="@this"
				listener="#{dialogHandlerAction.notificationDialog.sendTab.updateStatus()}"
				oncomplete="handleComplete(xhr, status, args)" />

			<p:remoteCommand name="updateContent"
				update=":adminForm:tabview:sendTab"></p:remoteCommand>

		</p:panelGrid>

	</div>

	<div class="bottomDiv">
		<h:panelGrid columns="2" style="width:100%"
			styleClass="noBordersAll collapsedBordersAll noPaddingAll">

			<h:panelGrid columns="1">

			</h:panelGrid>

			<h:panelGrid columns="2" style="float:right;">

				<p:commandButton value="Benachrichtigung ausführen"
					icon="fa fa-fw fa-mail-forward"
					rendered="#{!dialogHandlerAction.notificationDialog.sendTab.notificationCompleted}"
					onstart="PF('blockUIWidget').block()"
					onclick="performeNotificationCommand();PF('startNotificationButton').disable();PF('ajaxProgressPoll').start();"
					styleClass="smallButton buttonRighMarginInList"
					widgetVar="startNotificationButton" />

				<!-- close -->
				<p:commandButton value="#{msg['general.close']}"
					styleClass="smallButton buttonRighMarginInList"
					icon="fa fa-times-circle"
					actionListener="#{dialogHandlerAction.notificationDialog.hideDialog()}" />

				<p:remoteCommand async="true" name="performeNotificationCommand"
					actionListener="#{dialogHandlerAction.notificationDialog.sendTab.performeNotification()}"></p:remoteCommand>
			</h:panelGrid>
		</h:panelGrid>
	</div>

</ui:composition>
