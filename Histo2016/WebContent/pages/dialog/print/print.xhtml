<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:head>
	<title><h:outputFormat value="#{msg['dialog.print.headline']}" /></title>
	<h:outputStylesheet name="histo.css" value="histo.css" />
</h:head>


<h:body styleClass="defaultDialogLayout bigDialog">
	<h:form id="dialogContent">

		<div class="defaulDilaogHeaderDivWithBackground">
			<h:panelGrid style="width:100%;" columns="2"
				styleClass="noBordersAll noPaddingAll collapsedBordersAll">
				<h:outputLabel value="#{msg['dialog.print.headline']}" />
				<p:commandLink title="#{msg['general.close']}" style="float:right;"
					styleClass="noUnderlineAtLink"
					actionListener="#{dialogHandlerAction.printDialog.hideDialog()}">
					<i class="fa fa-fw fa-times" />
				</p:commandLink>
			</h:panelGrid>
		</div>

		<div class="contentDiv">
			<h:panelGrid columns="3" styleClass="defaultListingTableContainer"
				columnClasses="defaultListingTableColumnTop defaultListingTableColumn30,">
				<!-- left column -->

				<h:panelGrid columns="1" styleClass="defaultListingTableContainer">
					<h:panelGrid columns="2" styleClass="defaultListingTableCssOneCol"
						columnClasses="defaultListingTableColumn20," id="navigation">

						<!-- document type -->
						<h:outputLabel value="#{msg['dialog.print.document']}" />
						<p:selectOneMenu
							value="#{dialogHandlerAction.printDialog.selectedTemplate}"
							style="width:90% !important;"
							converter="#{dialogHandlerAction.printDialog.templateTransformer}"
							styleClass="customSerachSelectMenu">
							<f:selectItems
								value="#{dialogHandlerAction.printDialog.templateList}"
								var="template" itemLabel="#{template.name}"
								itemValue="#{template}" />

							<p:ajax update="@form" event="change"
								onstart="PF('blockUIWidget').block()"
								oncomplete="PF('blockUIWidget').unblock()"
								listener="#{dialogHandlerAction.printDialog.onChangePrintTemplate()}"></p:ajax>
						</p:selectOneMenu>

					</h:panelGrid>

					<!-- to -->
					<h:panelGrid columns="1" styleClass="defaultListingTableCssOneCol"
						style="margin-top:20px;" id="addressTable">
						<h:outputLabel value="#{msg['dialog.print.addresses']}" />

						<p:panelGrid styleClass="smallDatatable highlightedDataTable"
							style="width:100%">
							<f:facet name="header">
								<p:row>
									<p:column style="width:18px;">
										<h:outputLabel value="#"></h:outputLabel>
									</p:column>
									<p:column style="width:30px;">
										<h:outputLabel value="#{msg['dialog.print.count']}"></h:outputLabel>
									</p:column>
									<p:column style="width:80px;" />
									<p:column />
									<p:column style="width:15px" />
								</p:row>
							</f:facet>

							<c:forEach varStatus="outer"
								items="#{dialogHandlerAction.printDialog.contactList}"
								var="chooser">
								<p:row
									styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'ui-datatable-odd' : ''}">
									<!-- select -->
									<p:column>
										<p:selectBooleanCheckbox value="#{chooser.selected}"
											styleClass="smallCheckbox">
											<p:ajax event="change" process="@form" update="addressTable"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock()"
												listener="#{dialogHandlerAction.printDialog.onChooseContact(chooser)}"></p:ajax>
										</p:selectBooleanCheckbox>
									</p:column>

									<!-- count -->
									<p:column>
										<p:spinner value="#{chooser.copies}" styleClass="miniSpinner"
											disabled="#{!chooser.selected}" min="1" max="9"></p:spinner>
									</p:column>

									<!-- role -->
									<p:column>
										<h:outputLabel
											value="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}"
											title="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}">
											<f:converter converterId="org.histo.ui.TruncateConverter" />
											<f:attribute name="truncateAt" value="9" />
											<f:attribute name="continuationMark" value="..." />
										</h:outputLabel>
									</p:column>

									<!-- name -->
									<p:column>
										<h:outputLabel value="#{chooser.contact.person.fullName}"
											id="editAddress#{outer.index}">
											<f:converter converterId="org.histo.ui.TruncateConverter" />
											<f:attribute name="truncateAt" value="23" />
											<f:attribute name="continuationMark" value="..." />
										</h:outputLabel>

										<p:overlayPanel for="editAddress#{outer.index}"
											widgetVar="editAddressOver#{outer.index}"
											id="editAddressOver#{outer.index}" showEvent="mouseover"
											hideEvent="mouseout" onShow="updateOverlay#{outer.index}();">

											<h:outputText value="#{chooser.getGeneratedAddress()}"
												styleClass="preformatted" />
										</p:overlayPanel>
									</p:column>

									<p:column>
										<p:commandLink
											title="#{msg['dialog.settings.organization.edit.persons.remove']}"
											actionListener="#{dialogHandlerAction.customAddress.initAndPrepareBean(chooser)}">
											<i class="fa fa-gear" style="margin-left: 2px" />
											<p:ajax event="dialogReturn"
												update="editAddressOver#{outer.index}" />
										</p:commandLink>
									</p:column>
								</p:row>

								<!-- Organizations -->
								<c:forEach varStatus="inner"
									items="#{chooser.organizazionsChoosers}" var="organizazion">
									<p:row
										styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'ui-datatable-odd' : ''}"
										style="border-left: none; border-top: none; border-bottom: none">
										<p:column
											style="border-left: none; border-bottom: none;  border-top: none; background-color: inherit !important;">
										</p:column>
										<p:column
											style="text-align: center; border: 1px solid #aaaaaa;">
											<p:selectBooleanCheckbox value="#{organizazion.selected}"
												styleClass="smallCheckbox">
												<p:ajax event="change" process="@form" update="addressTable"
													onstart="PF('blockUIWidget').block()"
													oncomplete="PF('blockUIWidget').unblock()"
													listener="#{dialogHandlerAction.printDialog.onChooseOrganizationOfContact(organizazion)}"></p:ajax>
											</p:selectBooleanCheckbox>
										</p:column>
										<p:column colspan="3" styleClass="smallFont"
											style=" border: 1px solid #aaaaaa;">
											<h:outputText value="#{organizazion.organization.name}" />
										</p:column>
									</p:row>
								</c:forEach>
							</c:forEach>
						</p:panelGrid>
					</h:panelGrid>

					<!-- save file -->
					<h:panelGrid columns="2" styleClass="defaultListingTableCssOneCol"
						columnClasses="defaultListingTableColumn20,">

						<!-- document type -->
						<h:outputLabel value="Datei speichern" />
						<p:selectBooleanCheckbox />
					</h:panelGrid>
				</h:panelGrid>

				<h:panelGroup />

				<!-- right column -->
				<h:panelGrid columns="1" styleClass="defaultListingTableContainer">

					<h:panelGroup id="pdfRender">
						<p:media player="pdf"
							value="#{dialogHandlerAction.printDialog.pdfContent}"
							width="100%"
							rendered="#{dialogHandlerAction.printDialog.renderPdf}"
							height="630px"></p:media>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGrid>
		</div>

		<div class="buttonContainer" style="width: 100% !important">
			<h:panelGrid columns="1" style="width:100%"
				styleClass="noBordersAll collapsedBordersAll noPaddingAll">

				<h:panelGrid columns="4" style="float:right;">
					<!-- print -->
					<p:commandButton value="Drucken" icon="fa fa-print"
						styleClass="smallButton buttonRighMarginInListExtended"
						onstart="PF('blockUIWidget').block()"
						oncomplete="PF('blockUIWidget').unblock()"
						actionListener="#{dialogHandlerAction.printDialog.onPrintNewPdf()}"></p:commandButton>

					<!-- select printer -->
					<p:selectOneMenu styleClass="customSerachSelectMenu"
						panelStyleClass="customSerachSelectMenuPanel"
						converter="#{settingsHandler.printerListTransformer}"
						value="#{settingsHandler.selectedPrinter}" filter="true"
						filterMatchMode="contains" style="margin-right:10px">

						<f:selectItems value="#{settingsHandler.printerList}"
							var="printer" itemLabel="#{printer.name}" itemValue="#{printer}" />
					</p:selectOneMenu>

					<!-- download -->
					<p:commandButton value="Ã–ffnen" icon="fa fa-download" ajax="false"
						styleClass="smallButton buttonRighMarginInListExtended"
						actionListener="#{dialogHandlerAction.printDialog.onDownloadPdf}">
						<p:fileDownload
							value="#{dialogHandlerAction.printDialog.pdfContent}" />
					</p:commandButton>

					<!-- Abort button -->
					<p:commandButton value="#{msg['general.close']}" id="closeBtn"
						styleClass="smallButton buttonRighMarginInList"
						icon="fa fa-times-circle"
						actionListener="#{dialogHandlerAction.printDialog.hideDialog()}" />
				</h:panelGrid>
			</h:panelGrid>
		</div>
		<ui:include src="../../template/blockUi.xhtml"></ui:include>
	</h:form>
</h:body>
</html>
