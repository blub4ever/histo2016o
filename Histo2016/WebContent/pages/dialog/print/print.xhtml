<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:head>
	<title><h:outputFormat value="#{msg['dialog.print.headline']}" /></title>
	<h:outputStylesheet name="histo.css" value="histo.css" />
	<h:outputStylesheet name="histoNew.css" value="histoNew.css" />
</h:head>


<h:body styleClass="contentInputDialog">

	<h:form id="dialogContent">

		<div class="dialogHeader">
			<h:panelGrid style="width:100%;" columns="2"
				styleClass="newTableContainer">
				<h:outputLabel value="#{msg['dialog.print.headline']}" />
				<p:commandLink title="#{msg['general.close']}" style="float:right;"
					styleClass="noUnderlineAtLink"
					actionListener="#{dialogHandlerAction.printDialog.hideDialog()}">
					<i class="fa fa-fw fa-times" />
				</p:commandLink>
			</h:panelGrid>
		</div>


		<div class="dialogContent">
			<h:panelGrid columns="3" styleClass="newTableContainer"
				style="width: 100%" columnClasses="column30 columnTop, column2, ">
				<!-- left column -->

				<h:panelGrid columns="1" styleClass="newTableContainer">

					<h:panelGrid columns="2" styleClass="newStyleListingTable"
						id="navigation">
						<!-- document type -->
						<h:outputLabel value="#{msg['dialog.print.document']}" />
						<p:selectOneMenu
							value="#{dialogHandlerAction.printDialog.selectedTemplate}"
							style="width:90% !important;"
							converter="#{dialogHandlerAction.printDialog.templateTransformer}">
							<f:selectItems
								value="#{dialogHandlerAction.printDialog.templateList}"
								var="template" itemLabel="#{template.name}"
								itemValue="#{template}" />

							<p:ajax update="@form" event="change"
								onstart="PF('blockUIWidget').block()"
								oncomplete="PF('blockUIWidget').unblock()"
								listener="#{dialogHandlerAction.printDialog.onChangePrintTemplate(true)}"></p:ajax>
						</p:selectOneMenu>

					</h:panelGrid>

					<!-- to -->
					<h:panelGrid columns="1" styleClass="newStyleListingTable"
						style="margin-top:10px;" id="addressTable">

						<h:outputLabel value="#{msg['dialog.print.addresses']}" />

						<p:panelGrid styleClass="newStyleListingTable" style="width:100%">
							<f:facet name="header">
								<p:row>
									<p:column style="width:15px;">
										<h:outputLabel value="#"></h:outputLabel>
									</p:column>
									<p:column style="width:30px;">
										<h:outputLabel value="#{msg['dialog.print.count']}"></h:outputLabel>
									</p:column>
									<p:column style="width:80px;" />
									<p:column />
									<p:column style="width:15px" />
								</p:row>
							</f:facet>

							<c:forEach varStatus="outer"
								items="#{dialogHandlerAction.printDialog.contactList}"
								var="chooser">
								<p:row
									styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'oddColumnColoredTr' : ''}">
									<!-- select -->
									<p:column style="width:15px;" styleClass="columnTextCenter">
										<p:selectBooleanCheckbox value="#{chooser.selected}"
											styleClass="centerCheckbox">
											<p:ajax event="change" process="@form" update="addressTable"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock()"
												listener="#{dialogHandlerAction.printDialog.onChooseContact(chooser)}"></p:ajax>
										</p:selectBooleanCheckbox>
									</p:column>

									<!-- count -->
									<p:column style="width:30px;" styleClass="columnTextCenter">
										<p:spinner value="#{chooser.copies}"
											styleClass="oneNumberSpinner" disabled="#{!chooser.selected}"
											min="1" max="9"></p:spinner>
									</p:column>

									<!-- role -->
									<p:column style="width:80px;">
										<h:outputLabel rendered="#{chooser.contact.role ne 'NONE'}"
											value="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}"
											title="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}">
											<f:converter converterId="org.histo.ui.TruncateConverter" />
											<f:attribute name="truncateAt" value="9" />
											<f:attribute name="continuationMark" value="..." />
										</h:outputLabel>
									</p:column>

									<!-- name -->
									<p:column>
										<h:outputLabel value="#{chooser.contact.person.fullName}"
											id="editAddress#{outer.index}">
											<f:converter converterId="org.histo.ui.TruncateConverter" />
											<f:attribute name="truncateAt" value="20" />
											<f:attribute name="continuationMark" value="..." />
										</h:outputLabel>

										<p:overlayPanel for="editAddress#{outer.index}"
											widgetVar="editAddressOver#{outer.index}"
											rendered="#{!chooser.emptyAddress}"
											id="editAddressOver#{outer.index}" showEvent="mouseover"
											hideEvent="mouseout" onShow="updateOverlay#{outer.index}();">

											<h:outputText value="#{chooser.customAddress}"
												styleClass="lableLineBreak" />
										</p:overlayPanel>
									</p:column>

									<p:column style="width:15px">
										<p:commandLink rendered="#{!chooser.emptyAddress}"
											title="#{msg['dialog.print.individualAddress']}"
											actionListener="#{dialogHandlerAction.customAddressDialog.initAndPrepareBean(dialogHandlerAction.printDialog.task,chooser)}">
											<i class="fa fa-gear" style="margin-left: 2px" />
											<p:ajax event="dialogReturn"
												listener="#{dialogHandlerAction.printDialog.onChangeAddressManually(chooser)}"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock()"
												update="editAddressOver#{outer.index}" />
										</p:commandLink>
									</p:column>
								</p:row>

								<!-- Organizations -->
								<c:forEach varStatus="inner"
									items="#{chooser.organizazionsChoosers}" var="organizazion">
									<p:row
										styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'oddColumnColoredTr' : ''}"
										style="border-left: none; border-top: none; border-bottom: none">
										<p:column
											style="border-left: none; border-bottom: none;  border-top: none; background-color: inherit !important;">
										</p:column>
										<p:column
											style="text-align: center; border-left: 1px solid #aaaaaa !important;">
											<p:selectBooleanCheckbox value="#{organizazion.selected}"
												styleClass="centerCheckbox">
												<p:ajax event="change" process="@form" update="addressTable"
													onstart="PF('blockUIWidget').block()"
													oncomplete="PF('blockUIWidget').unblock()"
													listener="#{dialogHandlerAction.printDialog.onChooseOrganizationOfContact(organizazion)}"></p:ajax>
											</p:selectBooleanCheckbox>
										</p:column>
										<p:column colspan="3" styleClass="smallFont"
											style=" border: 1px solid #aaaaaa;">
											<h:outputText value="#{organizazion.organization.name}" />
										</p:column>
									</p:row>
								</c:forEach>
							</c:forEach>
						</p:panelGrid>
					</h:panelGrid>


					<h:panelGrid columns="2" styleClass="newStyleListingTable"
						columnClasses="columnMinWidth, columnAutoWidth">
						<!-- save file -->
						<h:outputLabel value="#{msg['dialog.print.save']}" />
						<p:selectBooleanCheckbox
							value="#{dialogHandlerAction.printDialog.savePDF}"
							title="#{msg['dialog.print.save.text']}" />

						<!-- auto update -->
						<h:outputLabel value="#{msg['dialog.print.autoRefresh']}" />
						<p:selectBooleanCheckbox
							value="#{dialogHandlerAction.printDialog.autoRefresh}"
							title="#{msg['dialog.print.autoRefresh.text']}">
							<p:ajax update="@form" event="change"
								onstart="PF('blockUIWidget').block()"
								oncomplete="PF('blockUIWidget').unblock()"
								listener="#{dialogHandlerAction.printDialog.onChangePrintTemplate()}"></p:ajax>
						</p:selectBooleanCheckbox>
					</h:panelGrid>
				</h:panelGrid>

				<h:panelGroup />

				<!-- right column -->
				<h:panelGrid columns="1" styleClass="newStyleListingTable">
					<h:panelGroup id="pdfRender">
						<p:media player="pdf"
							value="#{dialogHandlerAction.printDialog.pdfContent}"
							width="100%"
							rendered="#{dialogHandlerAction.printDialog.renderPdf}"
							height="630px"></p:media>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGrid>
		</div>

		<div class="buttonContainer">
			<h:panelGrid columns="2" style="width:100%"
				styleClass="newTableContainer">

				<h:panelGrid columns="1" styleClass="newTableContainer left">
				</h:panelGrid>

				<h:panelGrid columns="4" styleClass="newTableContainer right">
					<p:commandButton value="#{msg['dialog.print.button.fax']}"
						icon="fa fa-fax" title="#{msg['dialog.print.button.fax.text']}"
						rendered="#{dialogHandlerAction.printDialog.faxMode}"
						actionListener="#{dialogHandlerAction.faxPrintDocumentDialog.initAndPrepareBean(dialogHandlerAction.printDialog.task, dialogHandlerAction.printDialog.renderedContact.contact,dialogHandlerAction.printDialog.pdfContainer)}"></p:commandButton>

					<h:panelGrid columns="2"
						rendered="#{!dialogHandlerAction.printDialog.selectMode}">
						<!-- print -->
						<p:commandButton value="#{msg['dialog.print.button.print']}"
							icon="fa fa-print"
							title="#{msg['dialog.print.button.print.text']}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							actionListener="#{dialogHandlerAction.printDialog.onPrintNewPdf()}"></p:commandButton>

						<!-- select printer -->
						<p:selectOneMenu title="#{msg['dialog.print.selectPrinter']}"
							panelStyleClass="iconFixForSelectOneMenu"
							converter="#{globalSettings.printerListTransformer}"
							value="#{userHandlerAction.selectedPrinter}" filter="true"
							filterMatchMode="contains" style="margin-right:10px">

							<f:selectItems value="#{globalSettings.printerList}"
								var="printer" itemLabel="#{printer.name}" itemValue="#{printer}" />
						</p:selectOneMenu>
					</h:panelGrid>

					<!-- select -->
					<p:commandButton value="#{msg['dialog.print.button.select']}"
						icon="fa fa-print"
						rendered="#{dialogHandlerAction.printDialog.selectMode}"
						actionListener="#{dialogHandlerAction.printDialog.hideDialog()}"></p:commandButton>

					<!-- download -->
					<p:commandButton value="#{msg['dialog.print.button.open']}"
						icon="fa fa-download" ajax="false"
						title="#{msg['dialog.print.button.open.text']}"
						actionListener="#{dialogHandlerAction.printDialog.onDownloadPdf}">
						<p:fileDownload
							value="#{dialogHandlerAction.printDialog.pdfContent}" />
					</p:commandButton>

					<!-- Abort button -->
					<p:commandButton value="#{msg['general.close']}" id="closeBtn"
						icon="fa fa-times-circle">
						<f:actionListener
							binding="#{dialogHandlerAction.printDialog.resetPDF()}" />
						<f:actionListener
							binding="#{dialogHandlerAction.printDialog.hideDialog()}" />
					</p:commandButton>
				</h:panelGrid>
			</h:panelGrid>
		</div>

		<ui:include src="../../template/blockUi.xhtml"></ui:include>
	</h:form>
</h:body>
</html>
