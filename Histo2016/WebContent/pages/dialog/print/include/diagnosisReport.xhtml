<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<!-- script for scrolltable -->
	<h:outputScript library="scripts" name="scrollAbleTableCoumnSync.js" />

	<h:outputLabel value="#{msg['dialog.print.addresses']}" />

	<p:panelGrid styleClass="printDialog_AdressTable"
		id="addressScrollTable">
		<f:facet name="header">
			<p:row>
				<p:column>
					<h:outputLabel value="#"></h:outputLabel>
				</p:column>
				<p:column>
					<h:outputLabel value="#{msg['dialog.print.count']}"></h:outputLabel>
				</p:column>
				<p:column />
				<p:column />
				<p:column />
			</p:row>
		</f:facet>

		<c:forEach varStatus="outer"
			items="#{dialogHandlerAction.printDialog.selectedTemplate.contactList}"
			var="chooser">
			<p:row
				styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'alternate_row_background' : ''}">
				<!-- select -->
				<p:column>
					<p:selectBooleanCheckbox value="#{chooser.selected}">
						<p:ajax event="change" process="printSettingsTable"
							listener="#{dialogHandlerAction.printDialog.selectedTemplate.onChooseContact(chooser)}"
							update="printSettingsTable" />
					</p:selectBooleanCheckbox>
				</p:column>

				<!-- count -->
				<p:column>
					<p:spinner value="#{chooser.copies}" styleClass="oneNumberSpinner"
						disabled="#{!chooser.selected}" min="1" max="9"></p:spinner>
				</p:column>

				<!-- role -->
				<p:column>
					<h:outputLabel rendered="#{chooser.contact.role ne 'NONE'}"
						value="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}"
						title="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}">
						<f:converter converterId="org.histo.ui.TruncateConverter" />
						<f:attribute name="truncateAt" value="9" />
						<f:attribute name="continuationMark" value="..." />
					</h:outputLabel>
				</p:column>

				<!-- name -->
				<p:column>
					<h:outputLabel value="#{chooser.contact.person.fullName}"
						id="editAddress#{outer.index}">
						<f:converter converterId="org.histo.ui.TruncateConverter" />
						<f:attribute name="truncateAt" value="20" />
						<f:attribute name="continuationMark" value="..." />
					</h:outputLabel>

					<p:overlayPanel for="editAddress#{outer.index}"
						widgetVar="editAddressOver#{outer.index}"
						rendered="#{!chooser.emptyAddress}"
						id="editAddressOver#{outer.index}" showEvent="mouseover"
						hideEvent="mouseout" onShow="updateOverlay#{outer.index}();">

						<h:outputText value="#{chooser.customAddress}"
							styleClass="lableLineBreak" />
					</p:overlayPanel>
				</p:column>

				<p:column>
					<p:commandLink rendered="#{!chooser.emptyAddress}"
						title="#{msg['dialog.print.individualAddress']}"
						actionListener="#{dialogHandlerAction.customAddressDialog.initAndPrepareBean(dialogHandlerAction.printDialog.selectedTemplate.task,chooser)}">
						<i class="fa fa-gear" style="margin-left: 2px" />
						<p:ajax event="dialogReturn"
							update="editAddressOver#{outer.index}" />
					</p:commandLink>
				</p:column>
			</p:row>

			<!-- Organizations -->
			<c:forEach varStatus="inner" items="#{chooser.organizazionsChoosers}"
				var="organizazion">
				<p:row
					styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'alternate_row_background' : ''}">
					<p:column style="background-color: inherit !important;">
					</p:column>
					<p:column style="text-align: center;">
						<p:selectBooleanCheckbox value="#{organizazion.selected}">
							<p:ajax event="change" process="@form"
								update="printSettingsTable"
								listener="#{dialogHandlerAction.printDialog.selectedTemplate.onChooseOrganizationOfContact(organizazion)}"></p:ajax>
						</p:selectBooleanCheckbox>
					</p:column>
					<p:column colspan="3">
						<h:outputText value="#{organizazion.organization.name}" />
					</p:column>
				</p:row>
			</c:forEach>

		</c:forEach>
	</p:panelGrid>

	<script type="text/javascript">
		scrollAbleTableCoumnSync('#dialogContent\\:addressScrollTable', 16);
	</script>

	<h:outputLabel value="#{msg['dialog.print.diagnosisReport.diagnosis']}" />

	<p:panelGrid styleClass="printDialog_DiagosisTable"
		id="dignosisScrollTable">
		<f:facet name="header">
			<p:row>
				<p:column>
					<h:outputLabel value="#"></h:outputLabel>
				</p:column>
				<p:column>
					<h:outputLabel value=" "></h:outputLabel>
				</p:column>
			</p:row>
		</f:facet>

		<c:forEach varStatus="status"
			items="#{dialogHandlerAction.printDialog.selectedTemplate.diagnosisRevisions}"
			var="revision">

			<p:row>
				<p:column>
					<p:selectBooleanCheckbox value="#{revision.selected}">
						<p:ajax event="change" process="@this"
							listener="#{dialogHandlerAction.printDialog.onChangePrintTemplate()}"
							update="pollUpdateTable" />
					</p:selectBooleanCheckbox>
				</p:column>
				<p:column>
					<h:outputLabel value="#{revision.diagnosisRevision.name}"></h:outputLabel>
				</p:column>
			</p:row>
		</c:forEach>
	</p:panelGrid>

	<script type="text/javascript">
		scrollAbleTableCoumnSync('#dialogContent\\:dignosisScrollTable', 0);
	</script>

</ui:composition>
