<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<p:panelGrid styleClass="newStyleListingTable" style="width:100%">
		<f:facet name="header">
			<p:row>
				<p:column style="width:15px;">
					<h:outputLabel value="#"></h:outputLabel>
				</p:column>
				<p:column style="width:30px;">
					<h:outputLabel value="#{msg['dialog.print.count']}"></h:outputLabel>
				</p:column>
				<p:column style="width:80px;" />
				<p:column />
				<p:column style="width:15px" />
			</p:row>
		</f:facet>

		<c:forEach varStatus="outer"
			items="#{dialogHandlerAction.printDialog.contactList}" var="chooser">
			<p:row
				styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'oddColumnColoredTr' : ''}">
				<!-- select -->
				<p:column style="width:15px;" styleClass="columnTextCenter">
					<p:selectBooleanCheckbox value="#{chooser.selected}"
						styleClass="centerCheckbox">
						<p:ajax event="change" process="@form" update="addressTable"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							listener="#{dialogHandlerAction.printDialog.onChooseContact(chooser)}"></p:ajax>
					</p:selectBooleanCheckbox>
				</p:column>

				<!-- count -->
				<p:column style="width:30px;" styleClass="columnTextCenter">
					<p:spinner value="#{chooser.copies}" styleClass="oneNumberSpinner"
						disabled="#{!chooser.selected}" min="1" max="9"></p:spinner>
				</p:column>

				<!-- role -->
				<p:column style="width:80px;">
					<h:outputLabel rendered="#{chooser.contact.role ne 'NONE'}"
						value="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}"
						title="#{msg['enum.contactRole.'.concat(chooser.contact.role)]}">
						<f:converter converterId="org.histo.ui.TruncateConverter" />
						<f:attribute name="truncateAt" value="9" />
						<f:attribute name="continuationMark" value="..." />
					</h:outputLabel>
				</p:column>

				<!-- name -->
				<p:column>
					<h:outputLabel value="#{chooser.contact.person.fullName}"
						id="editAddress#{outer.index}">
						<f:converter converterId="org.histo.ui.TruncateConverter" />
						<f:attribute name="truncateAt" value="20" />
						<f:attribute name="continuationMark" value="..." />
					</h:outputLabel>

					<p:overlayPanel for="editAddress#{outer.index}"
						widgetVar="editAddressOver#{outer.index}"
						rendered="#{!chooser.emptyAddress}"
						id="editAddressOver#{outer.index}" showEvent="mouseover"
						hideEvent="mouseout" onShow="updateOverlay#{outer.index}();">

						<h:outputText value="#{chooser.customAddress}"
							styleClass="lableLineBreak" />
					</p:overlayPanel>
				</p:column>

				<p:column style="width:15px">
					<p:commandLink rendered="#{!chooser.emptyAddress}"
						title="#{msg['dialog.print.individualAddress']}"
						actionListener="#{dialogHandlerAction.customAddressDialog.initAndPrepareBean(dialogHandlerAction.printDialog.task,chooser)}">
						<i class="fa fa-gear" style="margin-left: 2px" />
						<p:ajax event="dialogReturn"
							listener="#{dialogHandlerAction.printDialog.onChangeAddressManually(chooser)}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							update="editAddressOver#{outer.index}" />
					</p:commandLink>
				</p:column>
			</p:row>

			<!-- Organizations -->
			<c:forEach varStatus="inner" items="#{chooser.organizazionsChoosers}"
				var="organizazion">
				<p:row
					styleClass="#{(outer.index + 1 ) mod 2 eq 0 ? 'oddColumnColoredTr' : ''}"
					style="border-left: none; border-top: none; border-bottom: none">
					<p:column
						style="border-left: none; border-bottom: none;  border-top: none; background-color: inherit !important;">
					</p:column>
					<p:column
						style="text-align: center; border-left: 1px solid #aaaaaa !important;">
						<p:selectBooleanCheckbox value="#{organizazion.selected}"
							styleClass="centerCheckbox">
							<p:ajax event="change" process="@form" update="addressTable"
								onstart="PF('blockUIWidget').block()"
								oncomplete="PF('blockUIWidget').unblock()"
								listener="#{dialogHandlerAction.printDialog.onChooseOrganizationOfContact(organizazion)}"></p:ajax>
						</p:selectBooleanCheckbox>
					</p:column>
					<p:column colspan="3" styleClass="smallFont"
						style=" border: 1px solid #aaaaaa;">
						<h:outputText value="#{organizazion.organization.name}" />
					</p:column>
				</p:row>
			</c:forEach>
		</c:forEach>
	</p:panelGrid>
</ui:composition>
